module.exports=[55694,a=>{"use strict";var b=a.i(51220),c=a.i(2295),d=a.i(41602),e=a.i(93995),f=a.i(26128),g=a.i(45305),h=a.i(40695),i=a.i(3130),j=a.i(7379),k=a.i(17171),l=a.i(38032),m=a.i(92432),n=a.i(2209),o=a.i(87695),p=a.i(86725),q=a.i(20755),r=a.i(53679),s=a.i(59070),t=a.i(3512),u=a.i(68234),v="Radio",[w,x]=(0,n.createContextScope)(v),[y,z]=w(v),A=c.forwardRef((a,d)=>{let{__scopeRadio:e,name:f,checked:g=!1,required:h,disabled:i,value:j="on",onCheck:k,form:n,...p}=a,[q,r]=c.useState(null),s=(0,m.useComposedRefs)(d,a=>r(a)),t=c.useRef(!1),u=!q||n||!!q.closest("form");return(0,b.jsxs)(y,{scope:e,checked:g,disabled:i,children:[(0,b.jsx)(o.Primitive.button,{type:"button",role:"radio","aria-checked":g,"data-state":E(g),"data-disabled":i?"":void 0,disabled:i,value:j,...p,ref:s,onClick:(0,l.composeEventHandlers)(a.onClick,a=>{g||k?.(),u&&(t.current=a.isPropagationStopped(),t.current||a.stopPropagation())})}),u&&(0,b.jsx)(D,{control:q,bubbles:!t.current,name:f,value:j,checked:g,required:h,disabled:i,form:n,style:{transform:"translateX(-100%)"}})]})});A.displayName=v;var B="RadioIndicator",C=c.forwardRef((a,c)=>{let{__scopeRadio:d,forceMount:e,...f}=a,g=z(B,d);return(0,b.jsx)(u.Presence,{present:e||g.checked,children:(0,b.jsx)(o.Primitive.span,{"data-state":E(g.checked),"data-disabled":g.disabled?"":void 0,...f,ref:c})})});C.displayName=B;var D=a=>{let{control:d,checked:e,bubbles:f=!0,...g}=a,h=c.useRef(null),i=(0,t.usePrevious)(e),j=(0,s.useSize)(d);return c.useEffect(()=>{let a=h.current,b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(i!==e&&b){let c=new Event("click",{bubbles:f});b.call(a,e),a.dispatchEvent(c)}},[i,e,f]),(0,b.jsx)("input",{type:"radio","aria-hidden":!0,defaultChecked:e,...g,tabIndex:-1,ref:h,style:{...a.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function E(a){return a?"checked":"unchecked"}var F=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],G="RadioGroup",[H,I]=(0,n.createContextScope)(G,[p.createRovingFocusGroupScope,x]),J=(0,p.createRovingFocusGroupScope)(),K=x(),[L,M]=H(G),N=c.forwardRef((a,c)=>{let{__scopeRadioGroup:d,name:e,defaultValue:f,value:g,required:h=!1,disabled:i=!1,orientation:j,dir:k,loop:l=!0,onValueChange:m,...n}=a,s=J(d),t=(0,r.useDirection)(k),[u,v]=(0,q.useControllableState)({prop:g,defaultProp:f,onChange:m});return(0,b.jsx)(L,{scope:d,name:e,required:h,disabled:i,value:u,onValueChange:v,children:(0,b.jsx)(p.Root,{asChild:!0,...s,orientation:j,dir:t,loop:l,children:(0,b.jsx)(o.Primitive.div,{role:"radiogroup","aria-required":h,"aria-orientation":j,"data-disabled":i?"":void 0,dir:t,...n,ref:c})})})});N.displayName=G;var O="RadioGroupItem",P=c.forwardRef((a,d)=>{let{__scopeRadioGroup:e,disabled:f,...g}=a,h=M(O,e),i=h.disabled||f,j=J(e),k=K(e),n=c.useRef(null),o=(0,m.useComposedRefs)(d,n),q=h.value===g.value,r=c.useRef(!1);return c.useEffect(()=>{let a=a=>{F.includes(a.key)&&(r.current=!0)},b=()=>r.current=!1;return document.addEventListener("keydown",a),document.addEventListener("keyup",b),()=>{document.removeEventListener("keydown",a),document.removeEventListener("keyup",b)}},[]),(0,b.jsx)(p.Item,{asChild:!0,...j,focusable:!i,active:q,children:(0,b.jsx)(A,{disabled:i,required:h.required,checked:q,...k,...g,name:h.name,ref:o,onCheck:()=>h.onValueChange(g.value),onKeyDown:(0,l.composeEventHandlers)(a=>{"Enter"===a.key&&a.preventDefault()}),onFocus:(0,l.composeEventHandlers)(g.onFocus,()=>{r.current&&n.current?.click()})})})});P.displayName=O;var Q=c.forwardRef((a,c)=>{let{__scopeRadioGroup:d,...e}=a,f=K(d);return(0,b.jsx)(C,{...f,...e,ref:c})});Q.displayName="RadioGroupIndicator";var R=a.i(7925),S=a.i(97895);function T({className:a,...c}){return(0,b.jsx)(N,{"data-slot":"radio-group",className:(0,S.cn)("grid gap-3",a),...c})}function U({className:a,...c}){return(0,b.jsx)(P,{"data-slot":"radio-group-item",className:(0,S.cn)("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...c,children:(0,b.jsx)(Q,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,b.jsx)(R.CircleIcon,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var V=a.i(46893),W=a.i(68515),X=a.i(95116),Y=a.i(72844),Z=a.i(77687),$=a.i(19113),_=a.i(33038),aa=a.i(52621),ab=a.i(96926);let ac=(0,a.i(61237).default)("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);var ad=a.i(75407),ae=a.i(3803);function af(){let[a,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)("pix"),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)([]),w=(0,d.useRouter)(),{toast:x}=(0,Z.useToast)(),{items:y,getTotal:z,clearCart:A}=(0,W.useCartStore)(),{user:B,isAuthenticated:C}=(0,W.useAuthStore)(),{addOrder:D}=(0,W.useOrderStore)();(0,c.useEffect)(()=>{n(!0)},[]),(0,c.useEffect)(()=>{m&&!C&&l(!0)},[m,C]),(0,c.useEffect)(()=>{let a=async()=>{if(0===y.length)return void v([]);try{let a=await fetch("/api/products");if(a.ok){let b=await a.json(),c=y.map(a=>{let c=b.products.find(b=>b.id===a.productId);if(c)return{...a,product:c};let d=X.mockProducts.find(b=>b.id===a.productId);return d?{...a,product:d}:null}).filter(Boolean);v(c)}else{let a=y.map(a=>{let b=X.mockProducts.find(b=>b.id===a.productId);return b?{...a,product:b}:null}).filter(Boolean);v(a)}}catch(a){console.error("Error fetching cart products:",a),v(y.map(a=>{let b=X.mockProducts.find(b=>b.id===a.productId);return b?{...a,product:b}:null}).filter(Boolean))}};m&&C&&y.length>0?a():0===y.length&&v([])},[y,m,C]);let E=z(),F=E>=X.mockMarket.minOrderValue?X.mockMarket.deliveryFee:0,G=E+F,H=async a=>{a.preventDefault(),t(!0);try{let a=B.addresses.find(a=>a.isDefault);if(!a)return void x({title:"Erro ao realizar pedido",description:"Você precisa ter um endereço padrão configurado.",variant:"destructive"});let b={items:u.map(a=>({productId:a.productId,productName:a.product.name,productImage:a.product.image,quantity:a.quantity,price:a.price,subtotal:a.price*a.quantity})),totalAmount:G,deliveryFee:F,subtotal:E,paymentMethod:o.toUpperCase(),deliveryAddressId:a.id,notes:q||void 0},c=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to create order")}let d=await c.json(),e={id:d.id,userId:d.userId,items:d.items,totalAmount:d.totalAmount,deliveryFee:d.deliveryFee,subtotal:d.subtotal,status:d.status.toLowerCase(),paymentMethod:d.paymentMethod.toLowerCase(),deliveryAddress:{id:d.deliveryAddress.id,street:d.deliveryAddress.street,number:d.deliveryAddress.number,complement:d.deliveryAddress.complement||void 0,neighborhood:d.deliveryAddress.neighborhood,city:d.deliveryAddress.city,state:d.deliveryAddress.state,zipCode:d.deliveryAddress.zipCode,isDefault:d.deliveryAddress.isDefault},createdAt:d.createdAt,estimatedDelivery:d.estimatedDelivery,notes:d.notes};D(e),A(),x({title:"Pedido realizado!",description:"Seu pedido foi enviado com sucesso."}),w.push("/client/orders")}catch(a){console.error("Error creating order:",a),x({title:"Erro ao realizar pedido",description:"Ocorreu um erro ao processar seu pedido. Tente novamente.",variant:"destructive"})}finally{t(!1)}};return m&&(C||a)?(0,b.jsxs)("div",{className:"min-h-screen bg-background pb-24",children:[(0,b.jsx)(e.ClientHeader,{showBack:!0}),(0,b.jsxs)("main",{className:"space-y-4 px-4 py-6",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"Finalizar pedido"}),(0,b.jsxs)("form",{onSubmit:H,className:"space-y-4",children:[(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)($.MapPin,{className:"h-5 w-5"}),"Endereço de entrega"]})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("p",{className:"font-bold flex items-center gap-2",children:[(0,b.jsx)(ae.User,{className:"h-4 w-4"})," ",B?.name]}),(0,b.jsxs)("p",{className:"text-sm flex items-center gap-2",children:[(0,b.jsx)($.MapPin,{className:"h-4 w-4"}),B?.addresses.find(a=>a.isDefault)?.street,","," ",B?.addresses.find(a=>a.isDefault)?.number,B?.addresses.find(a=>a.isDefault)?.complement&&`, ${B?.addresses.find(a=>a.isDefault)?.complement}`," ","-",B?.addresses.find(a=>a.isDefault)?.neighborhood,", ",B?.addresses.find(a=>a.isDefault)?.city," -",B?.addresses.find(a=>a.isDefault)?.state,","," ",B?.addresses.find(a=>a.isDefault)?.zipCode]}),(0,b.jsxs)("p",{className:"text-sm flex items-center gap-2",children:[(0,b.jsx)(ad.Phone,{className:"h-4 w-4"})," ",B?.phone]})]})})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(_.CreditCard,{className:"h-5 w-5"}),"Método de pagamento"]})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsxs)(T,{value:o,onValueChange:a=>p(a),children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(U,{value:"pix",id:"pix"}),(0,b.jsxs)(k.Label,{htmlFor:"pix",className:"flex items-center gap-2",children:[(0,b.jsx)(aa.Smartphone,{className:"h-4 w-4"}),"Pix"]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(U,{value:"credit",id:"credit"}),(0,b.jsxs)(k.Label,{htmlFor:"credit",className:"flex items-center gap-2",children:[(0,b.jsx)(_.CreditCard,{className:"h-4 w-4"}),"Cartão de crédito"]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(U,{value:"debit",id:"debit"}),(0,b.jsxs)(k.Label,{htmlFor:"debit",className:"flex items-center gap-2",children:[(0,b.jsx)(_.CreditCard,{className:"h-4 w-4"}),"Cartão de débito"]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(U,{value:"cash",id:"cash"}),(0,b.jsxs)(k.Label,{htmlFor:"cash",className:"flex items-center gap-2",children:[(0,b.jsx)(ab.DollarSign,{className:"h-4 w-4"}),"Dinheiro"]})]})]})})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(ac,{className:"h-5 w-5"}),"Observações"]})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsx)(V.Textarea,{placeholder:"Alguma observação sobre o pedido?",value:q,onChange:a=>r(a.target.value)})})]}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"space-y-3 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Subtotal"}),(0,b.jsx)("span",{className:"font-medium",children:(0,Y.formatCurrency)(E)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Taxa de entrega"}),(0,b.jsx)("span",{className:"font-medium",children:F>0?(0,Y.formatCurrency)(F):"Grátis"})]}),(0,b.jsx)(j.Separator,{}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"font-semibold",children:"Total"}),(0,b.jsx)("span",{className:"text-xl font-bold text-green-600",children:(0,Y.formatCurrency)(G)})]})]})}),(0,b.jsx)(h.Button,{type:"submit",className:"w-full",size:"lg",disabled:s,children:s?"Processando...":"Confirmar"})]})]}),(0,b.jsx)(f.BottomNav,{}),(0,b.jsx)(g.LoginModal,{isOpen:a,onClose:()=>l(!1),onLoginSuccess:()=>{}})]}):null}a.s(["default",()=>af],55694)}];

//# sourceMappingURL=app_client_checkout_page_tsx_85b2f2f6._.js.map