module.exports=[48035,e=>e.a(async(t,r)=>{try{var a=e.i(50942),s=e.i(15270),n=e.i(86687),o=e.i(29173),i=t([s]);async function d(e){try{let t,r=null,o=e.headers.get("authorization");if(o&&o.startsWith("Bearer "))r=o.substring(7);else{let t=e.headers.get("cookie");t&&(r=t.split(";").reduce((e,t)=>{let[r,a]=t.trim().split("=");return r&&a&&(e[r]=a),e},{}).token||null)}if(!r)return a.NextResponse.json({error:"unauthorized"},{status:401});try{t=await (0,n.verifyJwt)(r)}catch{return a.NextResponse.json({error:"invalid_token"},{status:401})}let i=await s.default.user.findUnique({where:{id:t.sub}});if(!i||"ADMIN"!==i.role)return a.NextResponse.json({error:"forbidden"},{status:403});let d=new URL(e.url),l=parseInt(d.searchParams.get("page")||"1"),u=parseInt(d.searchParams.get("limit")||"10"),c=(await s.default.order.findMany({include:{user:{select:{id:!0,name:!0,phone:!0,email:!0,cpf:!0}},items:!0,deliveryAddress:!0},orderBy:{createdAt:"desc"},skip:(l-1)*u,take:u})).map(e=>{let t="PENDING";switch(String(e.status)){case"PENDING":default:t="PENDING";break;case"CONFIRMED":case"PREPARING":case"DELIVERING":case"DELIVERED":t="CONFIRMED";break;case"CANCELLED":case"CANCELED":t="CANCELLED"}return{...e,status:t}}),p=await s.default.order.count();return a.NextResponse.json({orders:c,pagination:{currentPage:l,totalPages:Math.ceil(p/u),totalOrders:p,hasNextPage:l<Math.ceil(p/u),hasPrevPage:l>1}})}catch(e){console.error("Error fetching orders:",e),e.code&&console.error("Error code:",e.code),e.message&&console.error("Error message:",e.message),e.stack&&console.error("Error stack:",e.stack);try{console.log("Attempting to fetch orders with raw query...");let e=await s.default.$queryRaw`SELECT id, status FROM "Order" ORDER BY "createdAt" DESC LIMIT 5`;console.log("Raw orders:",e)}catch(e){console.error("Error with raw query:",e)}return a.NextResponse.json({error:"internal_server_error",details:e.message,code:e.code},{status:500})}}async function l(e){try{let t,r=null,i=e.headers.get("authorization");if(i&&i.startsWith("Bearer "))r=i.substring(7);else{let t=e.headers.get("cookie");t&&(r=t.split(";").reduce((e,t)=>{let[r,a]=t.trim().split("=");return r&&a&&(e[r]=a),e},{}).token||null)}if(!r)return a.NextResponse.json({error:"unauthorized"},{status:401});try{t=await (0,n.verifyJwt)(r)}catch{return a.NextResponse.json({error:"invalid_token"},{status:401})}let{items:d,totalAmount:l,deliveryFee:u,subtotal:c,paymentMethod:p,deliveryAddressId:h,notes:R}=await e.json();if(!d||!Array.isArray(d)||0===d.length)return a.NextResponse.json({error:"Items are required"},{status:400});if(!l||!u||!c)return a.NextResponse.json({error:"Amount fields are required"},{status:400});if(!p)return a.NextResponse.json({error:"Payment method is required"},{status:400});if(!h)return a.NextResponse.json({error:"Delivery address is required"},{status:400});if(!Object.values(o.PaymentMethod).includes(p))return a.NextResponse.json({error:"Invalid payment method"},{status:400});if(!await s.default.address.findUnique({where:{id:h,userId:t.sub}}))return a.NextResponse.json({error:"Invalid delivery address"},{status:400});let f=d.map(e=>e.productId),E=await s.default.product.findMany({where:{id:{in:f}}}),g=new Map(E.map(e=>[e.id,e]));for(let e of d)if(!g.has(e.productId))return a.NextResponse.json({error:`Product ${e.productId} not found`},{status:400});let m=await s.default.order.create({data:{userId:t.sub,totalAmount:l,deliveryFee:u,subtotal:c,paymentMethod:p,deliveryAddressId:h,notes:R,status:o.OrderStatus.PENDING,items:{create:d.map(e=>({productId:e.productId,productName:g.get(e.productId).name,productImage:g.get(e.productId).image,quantity:e.quantity,price:e.price,subtotal:e.subtotal}))}},include:{items:!0,deliveryAddress:!0,user:!0}});return a.NextResponse.json(m)}catch(e){return console.error("Error creating order:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}[s]=i.then?(await i)():i,e.s(["GET",()=>d,"POST",()=>l]),r()}catch(e){r(e)}},!1),15399,e=>e.a(async(t,r)=>{try{var a=e.i(384),s=e.i(46997),n=e.i(78567),o=e.i(32429),i=e.i(3581),d=e.i(87005),l=e.i(6889),u=e.i(53063),c=e.i(37604),p=e.i(19825),h=e.i(32746),R=e.i(88267),f=e.i(42982),E=e.i(67356),g=e.i(16725),m=e.i(18678),w=e.i(93695);e.i(84731);var v=e.i(69),N=e.i(48035),y=t([N]);[N]=y.then?(await y)():y;let I=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/orders/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:A,workUnitAsyncStorage:P,serverHooks:b}=I;function x(){return(0,n.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:P})}async function C(e,t,r){I.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/orders/route";a=a.replace(/\/index$/,"")||"/";let n=await I.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:N,params:y,nextConfig:x,parsedUrl:C,isDraftMode:A,prerenderManifest:P,routerServerContext:b,isOnDemandRevalidate:D,revalidateOnlyGenerated:O,resolvedPathname:T,clientReferenceManifest:M,serverActionsManifest:k}=n,j=(0,u.normalizeAppPath)(a),q=!!(P.dynamicRoutes[j]||P.routes[T]),S=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,C,!1):t.end("This page could not be found"),null);if(q&&!A){let e=!!P.routes[T],t=P.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await S();throw new w.NoFallbackError}}let _=null;!q||I.isDev||A||(_=T,_="/index"===_?"/":_);let U=!0===I.isDev||!q,H=q&&!U;k&&M&&(0,d.setReferenceManifestsSingleton)({page:a,clientReferenceManifest:M,serverActionsManifest:k,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:k})});let L=e.method||"GET",F=(0,i.getTracer)(),$=F.getActiveScopeSpan(),G={params:y,prerenderManifest:P,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>I.onRequestError(e,t,a,b)},sharedContext:{buildId:N}},B=new c.NodeNextRequest(e),K=new c.NodeNextResponse(t),z=p.NextRequestAdapter.fromNodeNextRequest(B,(0,p.signalFromNodeResponse)(t));try{let n=async e=>I.handle(z,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${L} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${a}`)}),d=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var i,l;let u=async({previousCacheEntry:s})=>{try{if(!d&&D&&O&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(o);e.fetchMetrics=G.renderOpts.fetchMetrics;let i=G.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let l=G.renderOpts.collectedTags;if(!q)return await (0,f.sendResponse)(B,K,a,G.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,E.toNodeOutgoingHttpHeaders)(a.headers);l&&(t[m.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,s=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==s?void 0:s.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,R.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:D})},b),t}},c=await I.handleResponse({req:e,nextConfig:x,cacheKey:_,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:P,isRoutePPREnabled:!1,isOnDemandRevalidate:D,revalidateOnlyGenerated:O,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:d});if(!q)return null;if((null==c||null==(i=c.value)?void 0:i.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});d||t.setHeader("x-nextjs-cache",D?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,E.fromNodeOutgoingHttpHeaders)(c.value.headers);return d&&q||p.delete(m.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,f.sendResponse)(B,K,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};$?await l($):await F.withPropagatedContext(e.headers,()=>F.trace(h.BaseServerSpan.handleRequest,{spanName:`${L} ${a}`,kind:i.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,R.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:D})}),q)throw t;return await (0,f.sendResponse)(B,K,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>x,"routeModule",()=>I,"serverHooks",()=>b,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>P]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=_6d2e7793._.js.map