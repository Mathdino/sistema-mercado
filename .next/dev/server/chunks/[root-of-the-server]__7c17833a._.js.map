{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/outros/market-delivery-app/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\n\nconst prismaClientSingleton = () => {\n  const connectionString = process.env.DATABASE_URL || \"\";\n  const pool = new Pool({ connectionString });\n  const adapter = new PrismaPg(pool);\n  return new PrismaClient({ adapter });\n};\n\ndeclare global {\n  var prisma: undefined | ReturnType<typeof prismaClientSingleton>;\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,wBAAwB;IAC5B,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY,IAAI;IACrD,MAAM,OAAO,IAAI,4GAAI,CAAC;QAAE;IAAiB;IACzC,MAAM,UAAU,IAAI,+OAAQ,CAAC;IAC7B,OAAO,IAAI,6IAAY,CAAC;QAAE;IAAQ;AACpC;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/outros/market-delivery-app/app/api/products/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport prisma from \"@/lib/prisma\";\r\n\r\nexport async function GET(\r\n  req: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params;\r\n    console.log(\"API route received ID:\", `\"${id}\"`);\r\n    console.log(\"ID type:\", typeof id);\r\n    console.log(\"ID truthy:\", !!id);\r\n    console.log(\"ID length:\", id ? id.length : 0);\r\n\r\n    // More comprehensive validation\r\n    if (!id) {\r\n      console.log(\"ID is null or undefined, returning 400\");\r\n      return NextResponse.json(\r\n        { error: \"Product ID is required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (typeof id !== \"string\") {\r\n      console.log(\"ID is not a string, returning 400\");\r\n      return NextResponse.json(\r\n        { error: \"Product ID must be a string\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const trimmedId = id.trim();\r\n    if (trimmedId === \"\" || trimmedId === \"undefined\" || trimmedId === \"null\") {\r\n      console.log(\"ID is empty or invalid string, returning 400\");\r\n      return NextResponse.json(\r\n        { error: \"Product ID is required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const product = await prisma.product.findUnique({\r\n      where: { id: trimmedId },\r\n      include: {\r\n        category: true,\r\n      },\r\n    });\r\n\r\n    if (!product) {\r\n      console.log(\"Product not found in database\");\r\n      return NextResponse.json({ error: \"Product not found\" }, { status: 404 });\r\n    }\r\n\r\n    // Check for promotion expiration\r\n    if (product.originalPrice && product.promotionEndsAt) {\r\n      const now = new Date();\r\n      const promotionEnd = new Date(product.promotionEndsAt);\r\n\r\n      if (now > promotionEnd) {\r\n        console.log(\"Promotion expired for product:\", product.name);\r\n        // Promotion expired, revert price in database\r\n        const updatedProduct = await prisma.product.update({\r\n          where: { id: product.id },\r\n          data: {\r\n            price: product.originalPrice,\r\n            originalPrice: null,\r\n            promotionEndsAt: null,\r\n            updatedAt: new Date(),\r\n          },\r\n          include: { category: true },\r\n        });\r\n        return NextResponse.json(updatedProduct);\r\n      }\r\n    }\r\n\r\n    return NextResponse.json(product);\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching product:\", error);\r\n    return NextResponse.json(\r\n      { error: \"internal_server_error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEO,eAAe,IACpB,GAAgB,EAChB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,QAAQ,GAAG,CAAC,0BAA0B,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;QAC/C,QAAQ,GAAG,CAAC,YAAY,OAAO;QAC/B,QAAQ,GAAG,CAAC,cAAc,CAAC,CAAC;QAC5B,QAAQ,GAAG,CAAC,cAAc,KAAK,GAAG,MAAM,GAAG;QAE3C,gCAAgC;QAChC,IAAI,CAAC,IAAI;YACP,QAAQ,GAAG,CAAC;YACZ,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,OAAO,OAAO,UAAU;YAC1B,QAAQ,GAAG,CAAC;YACZ,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,GAAG,IAAI;QACzB,IAAI,cAAc,MAAM,cAAc,eAAe,cAAc,QAAQ;YACzE,QAAQ,GAAG,CAAC;YACZ,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,MAAM,0HAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAC9C,OAAO;gBAAE,IAAI;YAAU;YACvB,SAAS;gBACP,UAAU;YACZ;QACF;QAEA,IAAI,CAAC,SAAS;YACZ,QAAQ,GAAG,CAAC;YACZ,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,iCAAiC;QACjC,IAAI,QAAQ,aAAa,IAAI,QAAQ,eAAe,EAAE;YACpD,MAAM,MAAM,IAAI;YAChB,MAAM,eAAe,IAAI,KAAK,QAAQ,eAAe;YAErD,IAAI,MAAM,cAAc;gBACtB,QAAQ,GAAG,CAAC,kCAAkC,QAAQ,IAAI;gBAC1D,8CAA8C;gBAC9C,MAAM,iBAAiB,MAAM,0HAAM,CAAC,OAAO,CAAC,MAAM,CAAC;oBACjD,OAAO;wBAAE,IAAI,QAAQ,EAAE;oBAAC;oBACxB,MAAM;wBACJ,OAAO,QAAQ,aAAa;wBAC5B,eAAe;wBACf,iBAAiB;wBACjB,WAAW,IAAI;oBACjB;oBACA,SAAS;wBAAE,UAAU;oBAAK;gBAC5B;gBACA,OAAO,+QAAY,CAAC,IAAI,CAAC;YAC3B;QACF;QAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}