{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/outros/market-delivery-app/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\n\nconst prismaClientSingleton = () => {\n  const connectionString = process.env.DATABASE_URL;\n  \n  if (!connectionString) {\n    throw new Error(\"DATABASE_URL environment variable is not set\");\n  }\n  \n  const pool = new Pool({ connectionString });\n  const adapter = new PrismaPg(pool);\n  \n  return new PrismaClient({\n    adapter,\n  });\n};\n\ndeclare global {\n  var prisma: undefined | ReturnType<typeof prismaClientSingleton>;\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma = prisma;"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,wBAAwB;IAC5B,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;IAEjD,IAAI,CAAC,kBAAkB;QACrB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;QAAE;IAAiB;IACzC,MAAM,UAAU,IAAI,+OAAQ,CAAC;IAE7B,OAAO,IAAI,6IAAY,CAAC;QACtB;IACF;AACF;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/outros/market-delivery-app/lib/password.ts"],"sourcesContent":["import crypto from \"crypto\"\n\nconst SALT_LEN = 16\nconst ITERATIONS = 120000\nconst KEY_LEN = 32\nconst DIGEST = \"sha256\"\n\nexport function hashPassword(password: string) {\n  const salt = crypto.randomBytes(SALT_LEN)\n  const derived = crypto.pbkdf2Sync(password, salt, ITERATIONS, KEY_LEN, DIGEST)\n  return `pbkdf2:${ITERATIONS}:${DIGEST}:${salt.toString(\"hex\")}:${derived.toString(\"hex\")}`\n}\n\nexport function verifyPassword(password: string, stored: string) {\n  const parts = stored.split(\":\")\n  if (parts.length !== 5 || parts[0] !== \"pbkdf2\") return false\n  const iterations = parseInt(parts[1], 10)\n  const digest = parts[2]\n  const salt = Buffer.from(parts[3], \"hex\")\n  const expected = Buffer.from(parts[4], \"hex\")\n  const derived = crypto.pbkdf2Sync(password, salt, iterations, expected.length, digest)\n  return crypto.timingSafeEqual(derived, expected)\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,WAAW;AACjB,MAAM,aAAa;AACnB,MAAM,UAAU;AAChB,MAAM,SAAS;AAER,SAAS,aAAa,QAAgB;IAC3C,MAAM,OAAO,gHAAM,CAAC,WAAW,CAAC;IAChC,MAAM,UAAU,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,YAAY,SAAS;IACvE,OAAO,CAAC,OAAO,EAAE,WAAW,CAAC,EAAE,OAAO,CAAC,EAAE,KAAK,QAAQ,CAAC,OAAO,CAAC,EAAE,QAAQ,QAAQ,CAAC,QAAQ;AAC5F;AAEO,SAAS,eAAe,QAAgB,EAAE,MAAc;IAC7D,MAAM,QAAQ,OAAO,KAAK,CAAC;IAC3B,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,KAAK,UAAU,OAAO;IACxD,MAAM,aAAa,SAAS,KAAK,CAAC,EAAE,EAAE;IACtC,MAAM,SAAS,KAAK,CAAC,EAAE;IACvB,MAAM,OAAO,OAAO,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE;IACnC,MAAM,WAAW,OAAO,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE;IACvC,MAAM,UAAU,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,YAAY,SAAS,MAAM,EAAE;IAC/E,OAAO,gHAAM,CAAC,eAAe,CAAC,SAAS;AACzC"}},
    {"offset": {"line": 137, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/outros/market-delivery-app/lib/jwt.ts"],"sourcesContent":["import crypto from \"crypto\"\n\nfunction base64url(input: Buffer | string) {\n  const buf = Buffer.isBuffer(input) ? input : Buffer.from(input)\n  return buf\n    .toString(\"base64\")\n    .replace(/=/g, \"\")\n    .replace(/\\+/g, \"-\")\n    .replace(/\\//g, \"_\")\n}\n\nexport async function signJwt(payload: Record<string, unknown>) {\n  const hasRS256 = !!(process.env.JWT_PRIVATE_KEY && process.env.JWT_PUBLIC_KEY)\n  const header = { alg: hasRS256 ? \"RS256\" : \"HS256\", typ: \"JWT\" }\n  const iat = Math.floor(Date.now() / 1000)\n  const expEnv = (process.env.JWT_EXPIRES_IN || \"7d\").toLowerCase()\n  const expSeconds =\n    expEnv.endsWith(\"d\")\n      ? parseInt(expEnv) * 24 * 60 * 60\n      : expEnv.endsWith(\"h\")\n      ? parseInt(expEnv) * 60 * 60\n      : expEnv.endsWith(\"m\")\n      ? parseInt(expEnv) * 60\n      : parseInt(expEnv) || 7 * 24 * 60 * 60\n  const exp = iat + expSeconds\n  const body = { ...payload, iat, exp }\n  const encodedHeader = base64url(JSON.stringify(header))\n  const encodedBody = base64url(JSON.stringify(body))\n  const signingInput = `${encodedHeader}.${encodedBody}`\n  let signature: Buffer\n  if (hasRS256) {\n    const privateKeyPem = (process.env.JWT_PRIVATE_KEY || \"\").trim()\n    const signer = crypto.createSign(\"RSA-SHA256\")\n    signer.update(signingInput)\n    signer.end()\n    signature = signer.sign(privateKeyPem)\n  } else {\n    const secret = (process.env.JWT_SECRET || \"\").trim()\n    const hmac = crypto.createHmac(\"sha256\", secret)\n    hmac.update(signingInput)\n    signature = hmac.digest()\n  }\n  const encodedSignature = base64url(signature)\n  return `${signingInput}.${encodedSignature}`\n}\n\nexport async function verifyJwt(token: string) {\n  const parts = token.split(\".\")\n  if (parts.length !== 3) throw new Error(\"invalid_token\")\n  const [encodedHeader, encodedBody, encodedSignature] = parts\n  const signingInput = `${encodedHeader}.${encodedBody}`\n  const signature = Buffer.from(encodedSignature.replace(/-/g, \"+\").replace(/_/g, \"/\"), \"base64\")\n  const hasRS256 = !!(process.env.JWT_PRIVATE_KEY && process.env.JWT_PUBLIC_KEY)\n  let ok: boolean\n  if (hasRS256) {\n    const publicKeyPem = (process.env.JWT_PUBLIC_KEY || \"\").trim()\n    const verifier = crypto.createVerify(\"RSA-SHA256\")\n    verifier.update(signingInput)\n    verifier.end()\n    ok = verifier.verify(publicKeyPem, signature)\n  } else {\n    const secret = (process.env.JWT_SECRET || \"\").trim()\n    const hmac = crypto.createHmac(\"sha256\", secret)\n    hmac.update(signingInput)\n    const expected = hmac.digest()\n    ok = crypto.timingSafeEqual(expected, signature)\n  }\n  if (!ok) throw new Error(\"invalid_signature\")\n  const payloadJson = Buffer.from(encodedBody.replace(/-/g, \"+\").replace(/_/g, \"/\"), \"base64\").toString(\"utf8\")\n  const payload = JSON.parse(payloadJson)\n  const now = Math.floor(Date.now() / 1000)\n  if (payload.exp && now > payload.exp) throw new Error(\"token_expired\")\n  return payload\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 217, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/outros/market-delivery-app/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport prisma from \"@/lib/prisma\"\nimport { verifyPassword } from \"@/lib/password\"\nimport { signJwt } from \"@/lib/jwt\"\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json()\n    const { cpf, password } = body || {}\n    if (!cpf || !password) {\n      return NextResponse.json({ error: \"missing_fields\" }, { status: 400 })\n    }\n    const cpfDigits = String(cpf).replace(/\\D/g, \"\")\n    if (cpfDigits.length !== 11) {\n      return NextResponse.json({ error: \"invalid_cpf\" }, { status: 400 })\n    }\n    const user = await prisma.user.findUnique({\n      where: { cpf: cpfDigits },\n      include: { addresses: true },\n    })\n    if (!user) {\n      return NextResponse.json({ error: \"user_not_found\" }, { status: 404 })\n    }\n    const ok = verifyPassword(password, user.passwordHash)\n    if (!ok) {\n      return NextResponse.json({ error: \"invalid_credentials\" }, { status: 401 })\n    }\n    const token = await signJwt({ sub: user.id, cpf: user.cpf, name: user.name })\n    const res = NextResponse.json({\n      user: {\n        id: user.id,\n        cpf: user.cpf,\n        name: user.name,\n        phone: user.phone,\n        role: user.role.toLowerCase(),\n        addresses: user.addresses.map((a) => ({\n          id: a.id,\n          street: a.street,\n          number: a.number,\n          complement: a.complement || undefined,\n          neighborhood: a.neighborhood,\n          city: a.city,\n          state: a.state,\n          zipCode: a.zipCode,\n          isDefault: a.isDefault,\n        })),\n        createdAt: user.createdAt.toISOString(),\n      },\n      token,\n    })\n    res.cookies.set(\"token\", token, {\n      httpOnly: true,\n      sameSite: \"lax\",\n      secure: process.env.NODE_ENV === \"production\",\n      path: \"/\",\n      maxAge: 60 * 60 * 24 * 7,\n    })\n    return res\n  } catch {\n    return NextResponse.json({ error: \"server_error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,GAAG,EAAE,QAAQ,EAAE,GAAG,QAAQ,CAAC;QACnC,IAAI,CAAC,OAAO,CAAC,UAAU;YACrB,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QACA,MAAM,YAAY,OAAO,KAAK,OAAO,CAAC,OAAO;QAC7C,IAAI,UAAU,MAAM,KAAK,IAAI;YAC3B,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACnE;QACA,MAAM,OAAO,MAAM,0HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,KAAK;YAAU;YACxB,SAAS;gBAAE,WAAW;YAAK;QAC7B;QACA,IAAI,CAAC,MAAM;YACT,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QACA,MAAM,KAAK,IAAA,mIAAc,EAAC,UAAU,KAAK,YAAY;QACrD,IAAI,CAAC,IAAI;YACP,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QACA,MAAM,QAAQ,MAAM,IAAA,uHAAO,EAAC;YAAE,KAAK,KAAK,EAAE;YAAE,KAAK,KAAK,GAAG;YAAE,MAAM,KAAK,IAAI;QAAC;QAC3E,MAAM,MAAM,+QAAY,CAAC,IAAI,CAAC;YAC5B,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,KAAK,KAAK,GAAG;gBACb,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI,CAAC,WAAW;gBAC3B,WAAW,KAAK,SAAS,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;wBACpC,IAAI,EAAE,EAAE;wBACR,QAAQ,EAAE,MAAM;wBAChB,QAAQ,EAAE,MAAM;wBAChB,YAAY,EAAE,UAAU,IAAI;wBAC5B,cAAc,EAAE,YAAY;wBAC5B,MAAM,EAAE,IAAI;wBACZ,OAAO,EAAE,KAAK;wBACd,SAAS,EAAE,OAAO;wBAClB,WAAW,EAAE,SAAS;oBACxB,CAAC;gBACD,WAAW,KAAK,SAAS,CAAC,WAAW;YACvC;YACA;QACF;QACA,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,OAAO;YAC9B,UAAU;YACV,UAAU;YACV,QAAQ,oDAAyB;YACjC,MAAM;YACN,QAAQ,KAAK,KAAK,KAAK;QACzB;QACA,OAAO;IACT,EAAE,OAAM;QACN,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF"}}]
}