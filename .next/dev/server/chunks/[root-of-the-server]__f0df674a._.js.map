{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/outros/market-delivery-app/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\n\nconst prismaClientSingleton = () => {\n  const connectionString = process.env.DATABASE_URL || \"\";\n  const pool = new Pool({ connectionString });\n  const adapter = new PrismaPg(pool);\n  return new PrismaClient({ adapter });\n};\n\ndeclare global {\n  var prisma: undefined | ReturnType<typeof prismaClientSingleton>;\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== \"production\") globalThis.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,wBAAwB;IAC5B,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY,IAAI;IACrD,MAAM,OAAO,IAAI,4GAAI,CAAC;QAAE;IAAiB;IACzC,MAAM,UAAU,IAAI,+OAAQ,CAAC;IAC7B,OAAO,IAAI,6IAAY,CAAC;QAAE;IAAQ;AACpC;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/outros/market-delivery-app/app/api/products/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport prisma from \"@/lib/prisma\"\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    // Get query parameters\r\n    const url = new URL(req.url)\r\n    const categoryId = url.searchParams.get(\"category\")\r\n    const search = url.searchParams.get(\"search\")\r\n    const featuredOnly = url.searchParams.get(\"featured\") === \"true\"\r\n    const onPromotion = url.searchParams.get(\"promotion\") === \"true\"\r\n\r\n    // Cleanup expired promotions\r\n    const now = new Date();\r\n    const expiredProducts = await prisma.product.findMany({\r\n      where: {\r\n        originalPrice: { not: null },\r\n        promotionEndsAt: { lt: now }\r\n      }\r\n    });\r\n\r\n    if (expiredProducts.length > 0) {\r\n      console.log(`Found ${expiredProducts.length} expired promotions. Cleaning up...`);\r\n      for (const product of expiredProducts) {\r\n        if (product.originalPrice) {\r\n          await prisma.product.update({\r\n            where: { id: product.id },\r\n            data: {\r\n              price: product.originalPrice,\r\n              originalPrice: null,\r\n              promotionEndsAt: null,\r\n              updatedAt: new Date()\r\n            }\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    // Build where clause for products\r\n    const whereClause: any = {}\r\n    \r\n    // Filter by category if provided\r\n    if (categoryId) {\r\n      whereClause.categoryId = categoryId\r\n    }\r\n    \r\n    // Filter by search term if provided\r\n    if (search) {\r\n      whereClause.OR = [\r\n        { name: { contains: search, mode: 'insensitive' } },\r\n        { description: { contains: search, mode: 'insensitive' } }\r\n      ]\r\n    }\r\n    \r\n    // Filter by featured products if requested\r\n    if (featuredOnly) {\r\n      whereClause.featured = true\r\n    }\r\n    \r\n    // Filter by products on promotion if requested\r\n    if (onPromotion) {\r\n      whereClause.originalPrice = { not: null }\r\n    }\r\n\r\n    // Fetch products with category information\r\n    const products = await prisma.product.findMany({\r\n      where: whereClause,\r\n      include: {\r\n        category: true\r\n      },\r\n      orderBy: {\r\n        createdAt: \"desc\"\r\n      }\r\n    })\r\n\r\n    // Fetch all categories for the category tabs\r\n    const categories = await prisma.category.findMany({\r\n      orderBy: {\r\n        name: \"asc\"\r\n      }\r\n    })\r\n\r\n    // Fetch featured products\r\n    const featuredProducts = await prisma.product.findMany({\r\n      where: {\r\n        featured: true\r\n      },\r\n      include: {\r\n        category: true\r\n      },\r\n      take: 10,\r\n      orderBy: {\r\n        createdAt: \"desc\"\r\n      }\r\n    })\r\n\r\n    // Fetch products on promotion\r\n    const promotionProducts = await prisma.product.findMany({\r\n      where: {\r\n        originalPrice: {\r\n          not: null\r\n        }\r\n      },\r\n      include: {\r\n        category: true\r\n      },\r\n      take: 10,\r\n      orderBy: {\r\n        createdAt: \"desc\"\r\n      }\r\n    })\r\n\r\n    return NextResponse.json({\r\n      products,\r\n      categories,\r\n      featuredProducts,\r\n      promotionProducts,\r\n      totalProducts: products.length\r\n    })\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching products:\", error)\r\n    return NextResponse.json({ error: \"internal_server_error\" }, { status: 500 })\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,uBAAuB;QACvB,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,aAAa,IAAI,YAAY,CAAC,GAAG,CAAC;QACxC,MAAM,SAAS,IAAI,YAAY,CAAC,GAAG,CAAC;QACpC,MAAM,eAAe,IAAI,YAAY,CAAC,GAAG,CAAC,gBAAgB;QAC1D,MAAM,cAAc,IAAI,YAAY,CAAC,GAAG,CAAC,iBAAiB;QAE1D,6BAA6B;QAC7B,MAAM,MAAM,IAAI;QAChB,MAAM,kBAAkB,MAAM,0HAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YACpD,OAAO;gBACL,eAAe;oBAAE,KAAK;gBAAK;gBAC3B,iBAAiB;oBAAE,IAAI;gBAAI;YAC7B;QACF;QAEA,IAAI,gBAAgB,MAAM,GAAG,GAAG;YAC9B,QAAQ,GAAG,CAAC,CAAC,MAAM,EAAE,gBAAgB,MAAM,CAAC,mCAAmC,CAAC;YAChF,KAAK,MAAM,WAAW,gBAAiB;gBACrC,IAAI,QAAQ,aAAa,EAAE;oBACzB,MAAM,0HAAM,CAAC,OAAO,CAAC,MAAM,CAAC;wBAC1B,OAAO;4BAAE,IAAI,QAAQ,EAAE;wBAAC;wBACxB,MAAM;4BACJ,OAAO,QAAQ,aAAa;4BAC5B,eAAe;4BACf,iBAAiB;4BACjB,WAAW,IAAI;wBACjB;oBACF;gBACF;YACF;QACF;QAEA,kCAAkC;QAClC,MAAM,cAAmB,CAAC;QAE1B,iCAAiC;QACjC,IAAI,YAAY;YACd,YAAY,UAAU,GAAG;QAC3B;QAEA,oCAAoC;QACpC,IAAI,QAAQ;YACV,YAAY,EAAE,GAAG;gBACf;oBAAE,MAAM;wBAAE,UAAU;wBAAQ,MAAM;oBAAc;gBAAE;gBAClD;oBAAE,aAAa;wBAAE,UAAU;wBAAQ,MAAM;oBAAc;gBAAE;aAC1D;QACH;QAEA,2CAA2C;QAC3C,IAAI,cAAc;YAChB,YAAY,QAAQ,GAAG;QACzB;QAEA,+CAA+C;QAC/C,IAAI,aAAa;YACf,YAAY,aAAa,GAAG;gBAAE,KAAK;YAAK;QAC1C;QAEA,2CAA2C;QAC3C,MAAM,WAAW,MAAM,0HAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YAC7C,OAAO;YACP,SAAS;gBACP,UAAU;YACZ;YACA,SAAS;gBACP,WAAW;YACb;QACF;QAEA,6CAA6C;QAC7C,MAAM,aAAa,MAAM,0HAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAChD,SAAS;gBACP,MAAM;YACR;QACF;QAEA,0BAA0B;QAC1B,MAAM,mBAAmB,MAAM,0HAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YACrD,OAAO;gBACL,UAAU;YACZ;YACA,SAAS;gBACP,UAAU;YACZ;YACA,MAAM;YACN,SAAS;gBACP,WAAW;YACb;QACF;QAEA,8BAA8B;QAC9B,MAAM,oBAAoB,MAAM,0HAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YACtD,OAAO;gBACL,eAAe;oBACb,KAAK;gBACP;YACF;YACA,SAAS;gBACP,UAAU;YACZ;YACA,MAAM;YACN,SAAS;gBACP,WAAW;YACb;QACF;QAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA;YACA;YACA,eAAe,SAAS,MAAM;QAChC;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}